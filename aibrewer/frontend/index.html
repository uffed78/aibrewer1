<!DOCTYPE html>
<html lang="sv">

<head>
    <meta charset="UTF-8">
    <title>√ñlrecept App</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Fix the CSS paths - use relative paths instead of '/function_a_v2/css/' -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/ingredient-selection.css">
    <!-- Add inline styles for critical CSS in case external styles fail to load -->
    <style>
        /* Basic fallback styles */
        body { margin: 0; font-family: Arial, sans-serif; }
        .sidebar { width: 220px; background: #f1f1f1; padding: 20px; }
        .main-content { padding: 20px; }
        .hidden { display: none; }
    </style>
</head>

<body>
    <!-- L√§gg till en inst√§llningsknapp i √∂vre h√∂gra h√∂rnet -->
    <button id="settingsBtn">‚öôÔ∏è Inst√§llningar</button>
    
    <!-- Inst√§llningsdialog -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Brewfather Inst√§llningar</h2>
            <div id="currentUserDisplay"></div>
            
            <form id="settingsForm">
                <div class="form-group">
                    <label for="username">Anv√§ndarnamn:</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label for="apiId">Brewfather API ID:</label>
                    <input type="text" id="apiId" required>
                </div>
                <div class="form-group">
                    <label for="apiKey">Brewfather API Key:</label>
                    <input type="password" id="apiKey" required>
                </div>
                <button type="submit">Spara inst√§llningar</button>
            </form>
            
            <div id="savedProfiles">
                <h3>Sparade profiler</h3>
                <div id="userProfilesList">
                    <!-- Sparade profiler kommer att listas h√§r -->
                </div>
            </div>
        </div>
    </div>
    
    <div class="sidebar">
        <button id="selectIngredientsBtn" class="btn btn-primary">V√§lj Ingredienser</button>
        <button id="generateXmlBtn">Generera BeerXML</button>
        <button id="brewerPersonalityBtn">
            <span id="currentBrewerIcon">üè∫</span> 
            <span id="currentBrewerName">Harald Traditionell</span>
        </button>
    </div>

    <!-- Personlighetsmodal -->
    <div id="personalityModal" class="personality-modal">
        <div class="personality-modal-content">
            <span class="close">&times;</span>
            <h2>V√§lj din bryggarm√§stare</h2>
            <p>Vem vill du ska hj√§lpa dig med dina √∂lrecept?</p>
            
            <div id="personalityGrid" class="personality-grid">
                <!-- Personlighetskort genereras dynamiskt via JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Fast personlighetsbadge i nedre h√∂gra h√∂rnet -->
    <div class="personality-badge" id="personalityBadge">
        <span class="personality-badge-icon" id="badgeIcon">üè∫</span>
        <span id="badgeName">Harald Traditionell</span>
    </div>

    <div class="main-content">
        <!-- Inventory Section -->
        <section id="inventorySection">
            <h2>Inventory</h2>
            <div id="inventoryDisplay">Klicka p√• "H√§mta Inventory" f√∂r att ladda ingredienser.</div>
        </section>

        <!-- Stilf√∂rslag Section -->
        <section id="styleSuggestionsSection" class="hidden">
            <h2>Stilf√∂rslag</h2>
            <div id="styleSuggestions"></div>
            <div>
                <label for="customStyle">Eller ange eget f√∂rslag:</label>
                <input type="text" id="customStyle" placeholder="T.ex. Schwarzbier">
                <button id="customStyleBtn">Skicka eget f√∂rslag</button>
            </div>
        </section>

        <!-- Receptutkast Section -->
        <section id="draftSection" class="hidden">
            <h2>Receptutkast</h2>
            <div id="draftDisplay"></div>
        </section>

        <!-- Chat Section - Now always visible -->
        <section id="chatContainer">
            <h2>Diskutera med GPT</h2>
            <div id="chatDisplay"></div>
            <div id="chatInputContainer">
                <input type="text" id="chatInput" placeholder="Skriv en fr√•ga om receptet...">
                <button id="sendChatBtn">Skicka</button>
            </div>
        </section>
    </div>

    <!-- Fix JavaScript paths - use relative paths instead of '/function_a_v2/js/' -->
    <script src="js/main.js"></script>
    <script src="js/api-client.js"></script>
    <script src="js/user-manager.js"></script>
    <script src="js/inventory-manager.js"></script>
    <script src="js/recipe-manager.js"></script>
    <script src="js/personality-manager.js"></script>
    <script src="js/chat-system.js"></script>
    <script src="js/ingredient-selection.js"></script>
    
    <!-- Add error tracking script -->
    <script>
        window.addEventListener('error', function(e) {
            console.error('Global error:', e.message, 'at', e.filename, 'line', e.lineno);
        });
        
        // Manually check if scripts have loaded properly
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM fully loaded');
            
            // Check each module
            setTimeout(function() {
                console.log('Checking modules...');
                console.log('APP_CONFIG exists:', typeof APP_CONFIG !== 'undefined');
                console.log('UserManager exists:', typeof UserManager !== 'undefined');
                console.log('ApiClient exists:', typeof ApiClient !== 'undefined');
                console.log('ChatSystem exists:', typeof ChatSystem !== 'undefined');
                console.log('RecipeManager exists:', typeof RecipeManager !== 'undefined');
                console.log('InventoryManager exists:', typeof InventoryManager !== 'undefined');
                console.log('PersonalityManager exists:', typeof PersonalityManager !== 'undefined');
            }, 500);
        });
    </script>
</body>
</html>